<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}Panel de Administración - MenuMastery{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    
    {% block extra_css %}{% endblock %}
</head>
<body class="admin" {% if current_user.is_authenticated %}data-user-authenticated="true"{% endif %}>
    <div class="admin-container">
        <header class="admin-header">
            <div class="d-flex justify-content-between align-items-center w-100">
                <!-- Título a la izquierda -->
                <div>
                    <h1 class="mb-0">Panel de Administración</h1>
                </div>
                
                <!-- Usuario y botón de salir a la derecha -->
                <div class="user-info d-flex align-items-center gap-3">
                    <span class="text-light">
                        <i class="fas fa-user me-1"></i>Administrador
                    </span>
                    <a href="{{ url_for('logout') }}" class="btn btn-sm btn-outline-light">
                        <i class="fas fa-sign-out-alt me-1"></i> Cerrar sesión
                    </a>
                </div>
            </div>
        </header>

        <nav class="admin-sidebar">
            <ul>
                <li class="{% if request.endpoint == 'admin_panel' %}active{% endif %}">
                    <a href="{{ url_for('admin_panel') }}">
                        <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                    </a>
                </li>
                <li class="{% if request.endpoint == 'gestion_platos' %}active{% endif %}">
                    <a href="{{ url_for('gestion_platos') }}">
                        <i class="fas fa-utensils me-2"></i>Gestión de Platos
                    </a>
                </li>
                
                <li class="{% if request.endpoint in ['gestion_inventario', 'ajustar_inventario', 'historial_inventario'] %}active{% endif %}">
                    <a href="{{ url_for('gestion_inventario') }}">
                        <i class="fas fa-boxes me-2"></i>Gestión de Inventario
                    </a>
                </li>


                <li class="{% if request.endpoint == 'reportes' %}active{% endif %}">
                    <a href="{{ url_for('reportes') }}">
                        <i class="fas fa-chart-bar me-2"></i>Reportes
                    </a>
                </li>

                <li class="{% if request.endpoint == 'configuracion_sistema' %}active{% endif %}">
                    <a href="{{ url_for('configuracion_sistema') }}">
                        <i class="fas fa-cog me-2"></i>Configuración
                    </a>
                </li>  
            </ul>
        </nav>

        <main class="admin-main">
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }} alert-dismissible fade show">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            {% block content %}
            <!-- Contenido del Dashboard Principal -->
            <div class="container-fluid py-4">
                <!-- Tarjetas de Estadísticas -->
                <div class="row mb-4">
                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="card stats-card bg-primary text-white">
                            <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h2 class="display-6 fw-bold">{{ total_usuarios }}</h2>
                                        <p class="mb-0">Usuarios Registrados</p>
                                    </div>
                                    <div class="align-self-center">
                                        <i class="fas fa-users fa-3x opacity-50"></i>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <small><i class="fas fa-arrow-up me-1"></i> 12% este mes</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="card stats-card bg-success text-white">
                            <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h2 class="display-6 fw-bold">{{ pedidos_hoy }}</h2>
                                        <p class="mb-0">Pedidos Hoy</p>
                                    </div>
                                    <div class="align-self-center">
                                        <i class="fas fa-shopping-cart fa-3x opacity-50"></i>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <small><i class="fas fa-arrow-up me-1"></i> 8% vs ayer</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="card stats-card bg-warning text-white">
                            <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h2 class="display-6 fw-bold">{{ productos_inventario }}</h2>
                                        <p class="mb-0">Productos en Inventario</p>
                                    </div>
                                    <div class="align-self-center">
                                        <i class="fas fa-box-open fa-3x opacity-50"></i>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <small>5 productos bajos en stock</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="card stats-card bg-info text-white">
                            <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h2 class="display-6 fw-bold">{{ reservas_activas }}</h2>
                                        <p class="mb-0">Reservas Activas</p>
                                    </div>
                                    <div class="align-self-center">
                                        <i class="fas fa-calendar-check fa-3x opacity-50"></i>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <small>3 reservas para hoy</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Acciones Rápidas y Gráficos -->
                <div class="row">
                    <!-- Acciones Rápidas -->
                    <div class="col-lg-6 mb-4">
                        <div class="card h-100">
                            <div class="card-header bg-white">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-bolt me-2 text-warning"></i>Acciones Rápidas
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <a href="{{ url_for('agregar_plato') }}" class="btn quick-action w-100 text-start p-3">
                                            <i class="fas fa-plus-circle fa-2x mb-2"></i>
                                            <h6>Agregar Plato</h6>
                                            <small>Crear nuevo plato en el menú</small>
                                        </a>
                                    </div>
                                    <div class="col-md-6">
                                        <a href="{{ url_for('gestion_inventario') }}" class="btn quick-action w-100 text-start p-3">
                                            <i class="fas fa-chart-line fa-2x mb-2"></i>
                                            <h6>Ver Inventario</h6>
                                            <small>Gestionar stock y productos</small>
                                        </a>
                                    </div>
                                    <div class="col-md-6">
                                        <a href="{{ url_for('reportes') }}" class="btn quick-action w-100 text-start p-3">
                                            <i class="fas fa-file-alt fa-2x mb-2"></i>
                                            <h6>Generar Reporte</h6>
                                            <small>Reportes de ventas y pedidos</small>
                                        </a>
                                    </div>
                                    <div class="col-md-6">
                                        <a href="{{ url_for('configuracion_sistema') }}" class="btn quick-action w-100 text-start p-3">
                                            <i class="fas fa-cog fa-2x mb-2"></i>
                                            <h6>Configuración</h6>
                                            <small>Configurar sistema y preferencias</small>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Actividad Reciente -->
                    <div class="col-lg-6 mb-4">
                        <div class="card h-100">
                            <div class="card-header bg-white">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-history me-2 text-info"></i>Actividad Reciente
                                </h5>
                            </div>
                            <div class="card-body recent-activity">
                                <div class="list-group list-group-flush">
                                    <div class="list-group-item d-flex align-items-center">
                                        <div class="flex-shrink-0">
                                            <i class="fas fa-utensils text-success"></i>
                                        </div>
                                        <div class="flex-grow-1 ms-3">
                                            <h6 class="mb-1">Nuevo plato agregado</h6>
                                            <p class="mb-0 text-muted">"Pasta Carbonara" fue añadido al menú</p>
                                            <small class="text-muted">Hace 2 horas</small>
                                        </div>
                                    </div>
                                    <div class="list-group-item d-flex align-items-center">
                                        <div class="flex-shrink-0">
                                            <i class="fas fa-shopping-cart text-primary"></i>
                                        </div>
                                        <div class="flex-grow-1 ms-3">
                                            <h6 class="mb-1">Pedido completado</h6>
                                            <p class="mb-0 text-muted">Pedido #125 fue entregado</p>
                                            <small class="text-muted">Hace 4 horas</small>
                                        </div>
                                    </div>
                                    <div class="list-group-item d-flex align-items-center">
                                        <div class="flex-shrink-0">
                                            <i class="fas fa-user text-warning"></i>
                                        </div>
                                        <div class="flex-grow-1 ms-3">
                                            <h6 class="mb-1">Nuevo usuario registrado</h6>
                                            <p class="mb-0 text-muted">María González se registró</p>
                                            <small class="text-muted">Hace 6 horas</small>
                                        </div>
                                    </div>
                                    <div class="list-group-item d-flex align-items-center">
                                        <div class="flex-shrink-0">
                                            <i class="fas fa-exclamation-triangle text-danger"></i>
                                        </div>
                                        <div class="flex-grow-1 ms-3">
                                            <h6 class="mb-1">Stock bajo</h6>
                                            <p class="mb-0 text-muted">"Ensalada César" bajo en inventario</p>
                                            <small class="text-muted">Hace 1 día</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gestión de Usuarios -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header bg-white">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-users-cog me-2 text-primary"></i>Gestión de Usuarios
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    <strong>Información importante:</strong> La gestión de usuarios ha sido delegada al rol de <strong>Usuario Manager</strong> 
                                    para mejorar la seguridad y separación de responsabilidades. Como administrador, puedes acceder a todas las demás funciones del sistema.
                                </div>
                                <div class="row text-center">
                                    <div class="col-md-4">
                                        <i class="fas fa-user-shield fa-2x text-warning mb-2"></i>
                                        <h6>Usuario Manager</h6>
                                        <p class="text-muted mb-0">Gestiona usuarios del sistema</p>
                                        <small class="text-muted">usermanager@menumastery.com</small>
                                    </div>
                                    <div class="col-md-4">
                                        <i class="fas fa-shield-alt fa-2x text-success mb-2"></i>
                                        <h6>Seguridad Mejorada</h6>
                                        <p class="text-muted mb-0">Separación de responsabilidades</p>
                                        <small class="text-muted">Solo admins pueden gestionar admins</small>
                                    </div>
                                    <div class="col-md-4">
                                        <i class="fas fa-cogs fa-2x text-info mb-2"></i>
                                        <h6>Administración</h6>
                                        <p class="text-muted mb-0">Enfocada en el negocio</p>
                                        <small class="text-muted">Platos, inventario, reportes</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Información del Sistema -->
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header bg-white">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-info-circle me-2 text-primary"></i>Información del Sistema
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="row text-center">
                                    <div class="col-md-3">
                                        <i class="fas fa-database fa-2x text-primary mb-2"></i>
                                        <h6>Base de Datos</h6>
                                        <p class="text-muted mb-0">Operacional</p>
                                    </div>
                                    <div class="col-md-3">
                                        <i class="fas fa-server fa-2x text-success mb-2"></i>
                                        <h6>Servidor</h6>
                                        <p class="text-muted mb-0">Online</p>
                                    </div>
                                    <div class="col-md-3">
                                        <i class="fas fa-shield-alt fa-2x text-warning mb-2"></i>
                                        <h6>Seguridad</h6>
                                        <p class="text-muted mb-0">Protegido</p>
                                    </div>
                                    <div class="col-md-3">
                                        <i class="fas fa-sync-alt fa-2x text-info mb-2"></i>
                                        <h6>Última Actualización</h6>
                                        <p class="text-muted mb-0">{{ now.strftime('%d/%m/%Y %H:%M') }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endblock %}
        </main>
    </div> 

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
    {% block extra_js %}{% endblock %}
</body>
</html>