{% extends "mesero/base.html" %}

{% block content %}
<h2>Pedidos Listos para Servir</h2>
<div class="list-group">
  {% for pedido in pedidos %}
  <div class="list-group-item">
    <h5>Pedido #{{ pedido.id }}</h5>
    <p>Mesa: {{ pedido.mesa or 'No especificada' }}</p>
    <p>Hora: {{ pedido.fecha.strftime('%H:%M') }}</p>
    <ul>
      {% for item in pedido.items %}
      <li>{{ item.cantidad }}x {{ item.plato.nombre }}</li>
      {% endfor %}
    </ul>
    <button class="btn btn-success btn-marcar-entregado" data-id="{{ pedido.id }}">Marcar como Entregado</button>
  </div>
  {% else %}
  <p>No hay pedidos listos para servir</p>
  {% endfor %}
</div>

<script>
// ActualizaciÃ³n en tiempo real
const eventSource = new EventSource('/stream-pedidos');
eventSource.onmessage = function(e) {
  if (e.data === 'actualizar') {
    location.reload();
  }
};

// Marcar pedido como entregado
document.querySelectorAll('.btn-marcar-entregado').forEach(btn => {
  btn.addEventListener('click', function() {
    fetch(`/pedido/${this.dataset.id}/entregar`, {
      method: 'POST'
    }).then(() => location.reload());
  });
});
</script>
{% endblock %}